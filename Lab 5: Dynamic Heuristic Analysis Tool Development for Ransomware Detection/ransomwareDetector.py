def count_file_actions(log_file):
    rename_count = 0
    modify_count = 0
    create_delete_count = 0
    created_files = set()

    with open(log_file, 'r') as file:
        for line in file:
            if line.startswith("File Rename:") and "ScapeGoat" in line:
                rename_count += 1
            elif line.startswith("File Modify:") and "ScapeGoat" in line:
                modify_count += 1
            elif line.startswith("File Create:"):
                file_info = line.strip().split(":")[1].split("\\")
                if len(file_info) == 2:
                    _, file_name = file_info
                else:
                    file_name = file_info[0]
                created_files.add(file_name.strip())
            elif line.startswith("File Delete:"):
                file_info = line.strip().split(":")[1].split("\\")
                if len(file_info) == 2:
                    _, file_name = file_info
                else:
                    file_name = file_info[0]
                if file_name.strip() in created_files:
                    create_delete_count += 1
    #print(rename_count, modify_count, create_delete_count)
    return rename_count, modify_count, create_delete_count

def check_for_malware(log_file):
    rename_count, modify_count, create_delete_count = count_file_actions(log_file)
    if rename_count > 3 and modify_count > 3 and create_delete_count >= 1:
        print("malware detected - HEUR:Trojan-Ransom.DocxEncrypt.Generic")
    else:
        print("No malware detected")

if __name__ == "__main__":
    log_file_path = "/workdir/log.txt"
    check_for_malware(log_file_path)
